---
title: 电源学习笔记
cover: /img/num148.webp
categories:
  - 硬件
comments: false
abbrlink: 71b1c380
date: 2023-08-31 20:10:02
---



## 前言

{% note blue 'fas fa-fan' flat %}资源网站\参考文章{% endnote %}

[STC-STC15W408AS系列说明](http://www.stcmicro.com/cn/stc/stc15w408as.html?eqid=e407e18700041447000000066448eb04)

[CSDN博主-STC15W408AS最小系统板](https://blog.csdn.net/weixin_42880082/category_11458655.html)

[RS485通信----基本原理+电路图](https://blog.csdn.net/MQ0522/article/details/128559845?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169699952216800192228592%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=169699952216800192228592&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-128559845-null-null.142^v95^insert_down28v1&utm_term=rs485&spm=1018.2226.3001.4187)





## DC-DC

### 12V转5V

- 已认证正常

> IC：MP1584EN-LF-Z

那个C10自举电容旁边串一个电阻原因是开关电源在跳变时可能会有尖峰出现，当串一个电阻后就变得平滑了

那个D5二极管的作用是当我们电压越低的时候，占空比是越大的，自举电容是在开关断开的时候充电(低电平)，当我们电压很低占空比很大，这时候电容充电的时间就非常短，可能导致电压不够了，那IC内部的管子可能就不会导通这样我们就无法输出5V了,所以这个二极管作用是在电压低时可以提高内部MOS管提供电压(相当于给自举电容提供电压)

注意元器件的最大承受电压选型

PCB布线注意R14的取样不要拿电感的，要拿C13或者C12的，然后尽量不要分割地平面，就是电源部分保持完整不要在底部有线经过

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230902115804.webp)

- 开关波形测量

首先看表笔是不是1X，如果是10X那示波器也要调到10X

然后我们这个是12V的所以需要调左下角，调到5V，那一格就是5V了

测开关波形的话耦合那选择直流即可

然后调时基，频率越高，那这个时间就应该越小，这个频率是1MHz，我们应该调到us级别

- 结果

开关波形还是不错的，R9电阻就是抑制上升沿那个尖峰的，但是这里好像还是有尖峰

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230930161421.webp)





## LDO

### 12V转5V

- 待认证

> IC：CJ7805

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230902020124.webp)



### 5V转3.3V

- 已验证

> IC：TP2019-3.3

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230831201953.webp)

> IC：AMS1117-3.3

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230930132722.webp)

> IC：RT9193-33GB

 `备注`：10uF钽电容要选择耐压高2倍的，比如10V

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230930133328.webp)

> IC：XC6204B332MR

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230930133549.webp)





## 电源课程学习

### 方案评估

> 反激式开关电源

选择需要考虑：

1. 输入输出电压，功率
2. 模块尺寸
3. 灌胶式还是PCBA的
4. 与底板的连接方式
5. 成本

一般小于100w的都选择反激式的，这次项目选择了12V 2A的，PCBA的：

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230925173550.webp)

> DCDC芯片选择

选择时需要考虑：

1. 输入输出电压，最大输出电流
2. 封装，成本
3. 如果需要过EMC，开关频率尽量选择低一点

- `5V输出`：选择MPS的降压芯片MP1584

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230925174949.webp)

- `3.3V输出`：选择TI的降压芯片TPS54331(找不到，所以拿TPS54331DDAR代替看看)

<img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230925175747.webp" style="zoom: 67%;" />

- `9V升压`：选择MICRONE(南京微盟)的ME2159

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230925180118.webp)





> LDO芯片选择

选择时需要考虑：

还要注意发热，`发热量=U*I*t(时间)`，所以不一定压差大就一定功耗大，需要综合考虑

1. 输入输出电压，最大输出电流
2. 封装(功耗 `U*I`)，静态电流，成本

- `5V输出`：选择低成本的 78L05

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230925195123.webp)

- `3.3V输出`：选择支持大电流的RT9018A

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230925195659.webp)

- `3.3V输出`：选择低静态电流的HT7333-3（一般用低功耗上）

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230925195816.webp)

- `2.5V输出`：选择可调的AP2127K-ADJTRG1

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230925200004.webp)

- `1.8V输出`：选择普通的ME6211C18M5G-N

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230925200121.webp)

> 系统框图

4V改为3.3V输出

<img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230925200949.webp" style="zoom: 80%;" />

### 原理图设计

#### 反激式电源模块

> 反激变换器的基本电路：



<img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230925201833.webp" style="zoom:50%;" />

- 首先看情况1(绿色部分)，Q1开关导通时，Lp电流慢慢往上增加，二极管截止，此时是通过电容给负载供电，看同名端，就是绕组的大黑点

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230925202329.webp)

- 情况2，当开关断开时，左边的电感的电流是不能突变的，它就会产生一个反激电压，变成上-下+，然后右边Nsm就会变成上+下-，同时初级存储的能量1/2LIp^2^传到次级，提供负载电流，同时给电容充电，相当于断开开关变成电感给负载供电

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230925203501.webp)

所以就需要电容要足够大，太小的话就会把电压拉下来

> 反激式变换器的优点

不需要输出滤波电感(因为正常来说是需要一个LC滤波的不然不加电感的话瞬间电流会很大，所以起到一个蓄能的作用，所以正激的话一般需要一个电感来滤波，而这个反激式的话里面的线圈相当于就是一个电感，所以就可以省略了一个电感)，因为反激变压器有着变压器与电感的双重功能，在输出功率为 `5~150W`的低成本隔离电源中应用非常广泛

> 本项目中反激式电源外围电路的设计

这个压敏电阻作用主要是防雷击的(当我们电源输入最高265V时当打雷时它电压会升高，就会损坏电源模块，而这个压敏电阻就会提供一个低阻抗回路)

热敏电阻的作用是，因为模块里面有一个比较大的滤波电容，刚上电时冲击电流(浪涌)比较大，这个热敏电阻起到一个保护作用，TVS管可以防止一些电压尖峰，提供低阻抗回路，然后加一个高频电容滤波

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230926133817.webp)

- 数据手册

压敏电阻主要看保护电压那，因为我们输入最大是265V所以选择最大电压是300V的

<img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230926142028.webp" style="zoom:67%;" />

热敏电阻

<img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230926142537.webp" style="zoom: 67%;" />

> 除了可以通过上面模块进行供电，还可以使用12V输入进行供电
>
> 注意爬电距离和电气间隙



#### Buck_5V降压电路

> 拓扑图

几乎所有降压DCDC都是基于此拓扑结构

输出电压相当于：

$Vout = Vin\times{D}\text{(开关频率占空比)}$

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230926152118.webp)

- 环路一，开关闭合时的电流路径；环路二，开关断开时的电流路径。闭合环路，变化的电流产生磁场，为了降低EMC，设计PCB时，环路设计应该尽量小，同时，不要干扰了模拟电路，比如反馈回路、增益补偿、软启动、使能电路等。

- 为了降低功耗，提高降压效率，功率电感应该选取低DCR的，饱和电流为平均电流的 `4/3`（经验值）；续流二极管D选取肖特基二极管，或选择同步降压IC(集成了续流二极管)
- 为了降低输出纹波，电感、电容需要选择合适的值，一般datasheet有推荐，电感值越大，相对纹波越小，但是，由于电感阻碍电流变化，导致响应负载的速度变慢；电容一般选用铝电解电容与陶瓷电容(低ESR)的组合；高度有限制或对成本不敏感时，可以选择钽电容，钽电容温度特性好，低ESR，寿命长，但成本高，耐压差( `耐压最好选择大于2倍的输出电压` )；
- 为了降低EMC，环路设计尽量小，输入部分可以增加π型滤波器，磁珠，电感部分可以增加RC高频吸收器;
- 根据需要，输入部分需要增加TVS抗浪涌，防反接保护电路，如果输入电容很大，避免上电时充电电流过大，可以考虑增加PTC电阻。

> 选型

1. 选型依据: 输入与输出电压，平均电流，最大电流，封装，成本等；
2. 品牌很多，像TI、MPS、南京微盟、UTC等，可以上立创商城查找。
3. MPS性价比不错，主要以MPS的MP2451与MP1584为例，其它型号，设计方法大同小异。

> 数据手册

1. 4.5V 至 28V 宽输入
2. 提供 3A 输出
3. 可编程开关频率100kHz 至 1.5MHz
4. 内部集成软启动

- 示例

这里输入电容C1不能取太大，太大的话上电充电时间很长，如果负载的功耗越大，那这个电容的容量应该大点，如果负载大容量低的话就会产生纹波，所以一般是输出3.3V/1A的，则这个电容选择22uF，3.3V/3A的则选择100uF

这个L1功率电感需要考虑饱和电流

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230926161218.webp)

输出电压主要看反馈电路的计算

$V_{OUT}=0.8\times\frac{124K+23.7K}{23.7K}=0.8\times6.2=4.96V$

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230926212336.webp)

功率电感：

<img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230926163842.webp" style="zoom:67%;" />

使能管脚电压要大于1.5V

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230926190043.webp)

FB引脚的电压需要是0.8V，这个是推荐值:

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230926213739.webp)

通过上面公式进行计算：

$V_{FB}=5\times\frac{23.7K}{124K+23.7K}=5\times0.16=0.8V$

FREQ引脚：

串联100K计算：

$100K=\frac{180000}{X}$

$X = 1800KHz$

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230926220201.webp)







> 本项目的原理图设计

输入首先是输入电容，耐压是16V满足要求

然后是使能管脚，电压要 `>1.5V`：

$\text{总电流I}=\frac{12V}{120K}=0.0001A$

$\text{EN引脚的电压}=20K\times0.0001A = 2V$

电感饱和电流是3.9A也满足要求

C7电解电容选择了220uF的因为输出是3A的，这样纹波就低点

D12是续流二极管，需要考虑耐压的

BST的话通过一个电容给他充电来驱动内部的MOS管，这个电阻的作用：充电时，开关波形它会有时不太稳定，加这个电阻的话它可以平滑这个波形，降低充电的速度

FREQ串联的电阻是控制频率的

COMP是增益补偿直接看参考电路取值即可

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230926214055.webp)



#### Buck_3V3降压电路

> 数据手册

3.5 至 28V输入电压范围

可调节输出电压低至 0.8V

3A 的连续输出电流

固定 570 kHz 开关频率，频率不可调

典型1μA 关断静态电流

> 参考电路

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230926222148.webp)

> 项目中原理图设计

SS是软启动，就是让电压慢慢往上升，不然的话上电一瞬间输出达到3.3V那输出电容充电电流就比较大，防止过冲

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230927103416.webp)



> PCB设计

首先就是把环路的功率器件先摆好，也就是拓扑图上的，然后其他的就靠近IC放就行了





#### Boost升压电路

> 拓扑图1

一开始时闭合打开状态，电流的流向(也给了电容充电)，Vin等于Vout，然后闭合这个开关，这个二极管起到一个隔离作用，闭合后这个电感会一直储能，而且闭合后电流肯定会很大的，当开关闭合后，电感存储的能量Vin就会流向Vout，而且给电容充电，假设现在是 `5V->12V`，电容充电充到12V后，然后我们把这个开关再闭合一次，由于这个二极管起到隔离作用，这个电容现在有10V左右，然后与负载形成回路，给这个负载提供能量，这个电容也会从12V慢慢的往下降同时电感也在储能，当电容又充到12V以上时又一个循环把开关打开为电容和负载提供能量让它提升到12V以上，最终它是在12V附近波动

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230927143845.webp)

在实际中，这个开关管一般选择场效应管，然后由IC或者MCU提供一个PWM波进行一个开关作用

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230927150908.webp)

而且这个开关的频率的话不能太慢，太慢的话会充电慢，这样电容会降得很厉害，然后再升，这样波动就很大，除非电容做的很大，才可以不让他这么快降下来

而且虽然电压升上去了，但是功耗是不会升的，反而降下来了，升压的话也会导致电流降下来，例如：

输入5V2A(功耗就是10W)，输出12V,功率还是10W，那电流就是0.8A左右 

公式里的占空比是下面图片那样的

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230927150838.webp)

> 拓扑图2

<img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230927151757.webp" style="zoom:67%;" />

`环路一，开关闭合时的电流路径，此时电源给电感充电，负载由电容供电`

`环路二，开关断开时的电流路径，电源与电感同时给电容充电，给负载供电，起到升压效果`

> 数据手册

精密反馈参考电压：0.6V，参考电压精度：+-2%

可调输出高达12V

内部固定PWM频率：650KHz

关断电流：0.1μA

过温保护：165℃

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230927171540.webp)



输出电压由从输出电压到 FB 的电阻分压器设置,FB引脚跟0.6V比较。产生误差然后输出PWM

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230927164647.webp)

通过上面这个公式计算：

$Vout = 0.6\times(1+\frac{124K+16K}{10K})=0.6\times15=9V$



> 本项目的原理图设计

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230927155703.webp)



> PCB设计

布局时，反馈环路一定要布好，不要受干扰不然会影响稳定性，功率器件要做到环路最小，再放反馈器件，再放模拟器件

布线时需要注意环路一定要粗(看拓扑环路1，它首先给电感充电然后经过内部开关然后到地，所以地是经过大电流的，所以需要在地引脚那多放点地过孔然后用铜箔框起来)

小器件比如电容那些就没必要覆铜了，不然一边导线大一边导线小会导致回流焊翘起来

反馈的话不要从电感那取电(不稳定)，要从电容那取电，而且线要单独走，不要共用其他的线



#### LDO电路

它是一个线性电源，它经过一个内部的管子，比如MOS管或者三极管，它内部有一个基准电压来控制管子的导通程度来达到一个稳压的目的，它输出电压肯定是小于输入电压的，输出纹波小，无开关噪声；

线性电源，`输出电流等于输入电流`， `发热功率(功耗) = 电压差 * 电流`，即 `P = (Vin-Vout) * I`

根据经验， `SOT-23封装`，发热功率不超过0.3W； `SOT-89封装` 发热功率不超过0.5W

LDO不适合电压差过大的场合，比如输入24V，输出3.3V，如果 `电流20mA，发热功率 = 20.7V*20mA = 0.41W`，效率是 `(输出电压/输入电压)*100%`，即 `(3.3V/24V) * 100% =13.75%`，效率太低了相当于24V输入，LDO吃了20.7V，输出3.3V

> LDO拓扑图

<img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230927185320.webp" style="zoom:67%;" />

> 本项目中的原理图设计---LDO1

正常如果不电阻分压的话：

$\text{功耗计算=}(12V-5V)*100mA=0.7W$

这个功耗已经很大了，所以前面两个15R电阻相当于起到一个分压的作用，12V经过两个电阻后(`U=IR=0.1A*30R=3V`)变成9V，压降就变成了4V，功耗就是 `4*100mA=0.4W`

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230927190532.webp)

- 数据手册

可以看到它这里输出5V需要输入至少是7V，所以压差必须大于2V

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230927190934.webp)

> 本项目中的原理图设计---LDO2

<img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230927194509.webp" style="zoom:67%;" />

- 数据手册

允许输入电压为高至30V

有几个固定的可供选择输出电压范围为2.1V至5.0V

静态电流最小是1uA

> 本项目中的原理图设计---LDO3

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230927203202.webp)

- 数据手册

最大输出电流：500mA

工作电压范围：1.2V～6.0V

低功耗：30uA

待机电流：0.1uA



> 本项目中的原理图设计---LDO4

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230927203211.webp)

- 数据手册

宽工作电压：2.5V 至 6V

高输出电压精度：±2%

低待机电流：0.1μA

低静态电流：60μA（典型值）

出色的线路/负载调节

为什么可调因为它没有把电阻集成了，可以通过调节电阻进行输出，下面的是内部集成了固定输出

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230927205819.webp)

输出电压计算：

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230927213401.webp)

$Vout = 0.8V \times (1+\frac{124K}{18K+40.2K}) = 0.8 \times 3.13 = 2.5V$



> 本项目中的原理图设计---LDO5

这个只能提供瞬间2A，不能持续输出2A

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230928093257.webp)



- 数据手册

最大 3A 低压降稳压器

3A 时通常为 210mV 压降

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230928095859.webp)

> PCB设计

LDO布局的话简单点，电容尽量靠近就行了

电流2A的话就线宽50mil即可

看拓扑，电流不会经过IC的GND引脚，相当于模拟地，所以IC的GND可以不用画这么粗，直接接地孔即可



### PCB设计

> ![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230925173607.webp)

- 统一过孔，外径为30mil,内径15mil，因为都是电源，没有信号线
- 火线和零线挨太近的话需要开窗
- 布线实现是布功率，然后反馈

- 最后把地线处理一下，那些GND通孔能引出来就最好，不用连接，引出来就行，要在底层引出，因为最后是在底层铺地铜
- 然后设计规则，铺铜距离板边30mil，然后高压电和ACDC模块那不用铺铜的，直接设置为禁止铺铜区域即可
- 最后可以添加一个2mm的贴片焊盘当做测试点

{% gallery %}

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230930115351.webp)

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230930115401.webp)

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230930115414.webp)

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230930115433.webp)

{% endgallery %}





### 焊接

- 温度设置300-400度即可，一般设400即可，但是要焊快，不然会焊坏
- 焊烙铁一般是马蹄形和刀型，刀型可以拖焊，马蹄形可以点焊和拖焊(推荐)
- 焊锡丝一般是0.8mm即可

- 如果是小批量的，有插件的话最好做一个治具进行后焊，这样速度快

> R30,R32,R41,R63电阻10K换成1K；R35电阻1K换成220R；LED会亮点

> TPS54331DDAR焊接出现没输出现象，经排查，得把D7和D8两个二极管去掉才能正常，原因也暂时不知道

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20231006085541.webp)

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20231006085557.webp)



### 调试

- 首先焊完不要急着上电，不然烧了就白焊，首先检查一下二极管，IC有没有焊反什么的，虚焊的
- 用万用表测一下板子的输入电压和输出电压对地的阻抗，有没有短路等，把万用表打到欧姆档，黑线接地线(关闭板子电源！！！)，然后红线去测电压输出端或者输入端：

1. 如果万用表测量到一个非常低的阻抗值（接近于0欧姆），则表示可能存在短路。这意味着电压输入引脚与接地之间有一个直接连接
2. 如果测量显示一个非常高的阻抗值（很大的数值或无穷大），则表示不存在短路问题。这意味着电压输入引脚与接地之间没有明显的连接
3. 交流电测试的话可以直接拿插头然后把另一头剪了漏出两条线，然后用万用表测一下哪条零线哪条火线：万用表打到交流电压档，然后黑线悬空，红色线分别去接触两条线，电压数值小的(一般不超过10V)是零线，电压大的(一般大于10V)是火线，然后就接到单片机板子即可
4. `最后测试电压输出没问题然后用导热胶把电解电容，火线零线，NTC电阻和压敏电阻的引脚涂上，用于散热还有封闭防止手触碰到`

> 测电压输出

需要有电子负载仪模拟负载(接电压输出端)，然后直流源提供电压电流，加个万用表，空载就是不接东西，50%负载就是IC最大输出电流的50%，满载就是IC最大输出电流

ACDC模块测量的话要测3脚输出端，不要测二极管那，因为二极管有压降

> 开关波形

LDO一般是线性电源，没有开关波形的，ACDC因为是模块买的所以也不测了

测量的话一般是测输出脚到电感的那一段

- MP1584EN

参考数据手册给出的波形示例，一般测出来的跟数据手册差不多就表示OK了

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230930183922.webp)



- TPS54331DDAR

手册没有，直接测

> 输出纹波

- 测纹波的话要测经过电感后电容滤波后的部分，不要测电感的
- 然后调节示波器到mV级别，50mV左右即可，时基的话就设置为几十ms就行了

这个时基的设置是和噪声的下限带宽相关，假如设置为1s/div因为示波器横向格子一般为10格所以最低能显示的完整带宽频率下限为: `1/(1*10) =0.1Hz`, 如果是25ms/div 那么带宽下限为: `1/(0.025*10) =4Hz`。对于普通电源可以直接用示波器进行测量，但是对于低噪声电源光有示波器是不行的，必须搭配高性能前置放大器才可以。

- 测直流纹波示波器就设为交流耦合，测交流纹波示波器就直流耦合(不然测不出来的)

因为示波器的直流耦合模式会自动去除输入信号中的直流分量，只显示交流成分

- 一般纹波在5%以内还是不错的

> 转换效率

LDO的效率的话直接 `(输出电压/输入电压)*100%`，因为它是线性电源，输入输出电流是一样的

开关电源的话因为输入和输出电流不一样，所以需要手动去测轻载，50%负载，满载情况下的效率：

注意测量输入电压要在二极管后面测才准，不能直接测一开始输入的那里，因为二极管有压降，一般电流越大，压降越大

$\text{输出电流}\times\text{输出电压}\div\text{输入电流}\div\text{输入电压}$

效率越高，发热越小

- MP1584EN

手册一般也有写的效率参考，1A时大概是89%左右

<img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20231001092439.webp" style="zoom: 80%;" />

- TPS54331

<img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20231001094929.webp" style="zoom: 80%;" />

### 示波器的使用

按 `CHx` 可以调参数，比如笔是1x还是10x，耦合，带宽

触发模式有：自动(Auto)，单次(Single)，正常(Default)，就在示波器最右边一般，一般单次和正常模式用来抓波形比较好

### 结语

最终板子功能正常，电路也验证成功





## 开源项目

### 485控制输出0-10V



#### 原理图

> 注意TL431的封装，有的也是SOT-23封装，但是有的1,2脚是调转的，我们买的这款是1脚REF,2脚CATHODE

### 继电器控制

参考文章：[orCAD导出bom步骤超详细](https://blog.csdn.net/xujuju7607/article/details/125898982)



#### 原理图/PCB

> 继电器选择了 `HF32F/12-ZS3`，注意它的管脚分布
>
> ![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20231003164905.webp)



#### 焊接

> 没什么需要注意的,那个插片封装间距大了导致不能插入，其他的也很正常
>
> 还有就是485芯片和兼容串口的两个电阻不能同时焊，只能使用其一，否则没效果

<img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20231011173226.webp" style="zoom:67%;" />



#### 程序







### 网络时钟

{% note blue 'fas fa-fan' flat %}参考文章/博客{% endnote %}

[STM32+ESP8266获取天气+解析天气hal库附源码](https://download.csdn.net/download/qq_59324611/86756430)

[STM32使用ESP8266模块AT指令连接心知天气API获取天气信息](https://blog.csdn.net/weixin_46084281/article/details/128772734?spm=1001.2014.3001.5502)

[物联网小项目——墨水屏时钟STM32+ESP8266实现](https://blog.csdn.net/weixin_46084281/article/details/129090187?spm=1001.2014.3001.5502)

[gitee- 网络天气时钟](https://gitee.com/guo-lingran/network-weather-clock)



> 硬件外设：
>
> 主控芯片STM32F103RET6( `flash:512K;ram:64K` )
>
> 1.54寸墨水屏( `SDI,CLK,CS,D/C,BUSY` )
>
> ESP01S( `RST,EN,TX,RX` )
>
> PAJ7620U2手势识别模块( `SCL,SDA` )
>
> 蜂鸣器
>
> 按键3个
>
> ADC用2路
>
> SHT30温湿度( `SCL,SDA` )
>
> RGB共阳灯( `R,G,B` )
>
> 锂电池3.7V可充电





#### 原理图/PCB

> ![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20231006212643.webp)
>
> ![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20231006212654.webp)
>
> <img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20231007185452.webp" style="zoom:50%;" />
>
> 尺寸是`19.7mm x 15mm`
>
> <img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20231007220758.webp" style="zoom:50%;" />
>
> ![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20231007220810.webp)



#### 问题

> 这个USB供电和锂电池供电自动切换电路：
>
> ![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20231006201519.webp)
>
> `情况1`：当USB没有插入时，BAT会通过PMOS的体二极管到达S极，体二极管压降(手册写大概0.75V)那么S极电压为4.25V，直接给VCC供电，此时G极通过10K电阻接地，那么GS之间的电压为-4.25V( `Vth是-0.4V~-1.3V，|Vgs| > |Vth|` )，MOS导通，此时BAT和VCC导通
>
> `情况2`：当USB插入时，G极为5V，S极为4.25V此时MOS管无法导通( `Vgs > Vth` )，5V通过D1(D1二极管有压降大概0.55V)给VCC供电，此时VCC为4.45V
>
> 注意D和S的位置，如果接反，当USB插入时，VCC的电压会通过PMOS管的体二极管倒灌给BAT



## 知识点1

> LDO电路滤波一般是一个大容值的电解电容加一个小容值的陶瓷电容并联，因为电解电容的寄生电阻比较大，陶瓷电容则寄生电阻比较小，提高滤波效果
>
> - LDO输入端的电容怎么选？
>
> 比如在PCB中前端的5V电源到LDO有一段距离，当5V电源不能够及时供给LDO电流时，通过并联一个大电容进行提供能量（这也是为什么IC电源旁要并联电容的作用，有多个供电引脚时，就要相对应的并联等同数量的电容），而由并联一个小电容的作用是滤除电源高频杂波。选择电容不单单只是考虑容值，还要考虑耐压、ESR等因素
>
> - LDO输出端的电容怎么选？
>
> 输出电容是为了输出电压的稳定以及为后续电路提供能量，手册中给到的输出电容是1uF–22uF
>
> - PCB设计时，应该考虑什么？
>
> 应该考虑一下几点：散热、电源线的粗细、电容的顺序
>
> 散热：部分LDO需要加散热片及散热过孔的，设计时要注意；
>
> 电源线的粗细：根据工作电流的大小对电源线进行调整；
>
> 电容的顺序：要根据原理图的顺序进行布线。，一般遵守输入端小电容靠近引脚，输出端大电容靠近引脚

> `什么是同名端和异名端？`
>
> <img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230925205516.webp" style="zoom:50%;" />
>
> 直流电流(红色那条)慢慢加大的时候，另一个线圈也是同方向的电动势，同名端就是直流电流慢慢加大时，另一个线圈感应出来输出也是+电(下面进+电上面输出+电，它们电压极性相同，只是一个进一个出，所以把这两个端叫同名端，右边两个-电也是同名端)
>
> <img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230925205711.webp" style="zoom:80%;" />
>
> 下面左下输入+电上面右上输出-电，叫做异名端
>
> <img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230925210239.webp" style="zoom:80%;" />
>
> 电路中，不标则表示默认同名端，像这样，也可以一起标下面
>
> ![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230925210711.webp)
>
> 另一种情况是这样的，但是有时候为了画图方便，相关把右边调转画
>
> ![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230925210917.webp)
>
> 变成这样(等价于上面)，标的点也可以上下调换：
>
> ![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230925211011.webp)
>
> 怎么找同名端？
>
> 通电瞬间LED闪一下就灭的是同名端，断电瞬间LED闪一下则是异名端，为什么闪一下呢
>
> <img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230925211736.webp" style="zoom:80%;" />

> AC->DC电源的话一般有 `反激，LLC，推挽，正激`，因为它就是100W以内的性价比之王，但是超过100W的话效率就变得比较低

> 下面这图是反激式电源的流程：220V的交流电经过二极管整流以及电容的滤波后到①就变成了310V的直流电，再经过一个MOS管开关②就产生一个PWM波送入到变压器的初级线圈(即左边线圈)，然后次级线圈感应出的电压再经过整流滤波就输出一个5V的直流电③
>
> ![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230926075424.webp)
>
> 这里主要就是中间那个变压器，还有就是一般只有正弦波那种交流电可以穿过变压器的，而且输入输出电压等于两个线圈的匝数比，那刚刚那个方波又是怎么穿过变压器呢？
>
> $\frac{Vin}{Vout} = \frac{N1}{N2}$
>
> ![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230926080718.webp)
>
> 这个问题也是整个反激架构中最精妙的地方，当MOS管关闭到打开时就会有一个电流流到左边的线圈中，从而在铁芯中感应出一个变化的磁场，那这个变化的磁场又因为在左边线圈中感应出一个电压，又因为两个线圈是反着绕的，即左边上+下-，右边是上-下+，然后因为我们在右边加了一个二极管，所以右边环路其实不存在电流的，相当于右边电路不存在了，所以此时初级线圈其实就是一个普通的电感，此时电流流过电感，电感就存储着能量
>
> <img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230926081632.webp" style="zoom:67%;" />
>
> 然后到这里，MOS管就瞬间关闭了，原本上左边电感上的电流是上到下流，MOS管关闭后，电流就瞬间变成0了，因为电感上的电流不能突变，所以此时会在初级线圈内部感应出一个上负下正的电压来阻止这个突变，也就是说在MOS管关闭瞬间初级线圈两端的电压会瞬间从上+下-变成上-下+，然后此时这个电压又正好会在次级线圈这边感应出一个上+下-的电压，然后这条通路就有了电流，然后这个电流的一部分就给这颗电容充电，然后另一部分就给了后极负载供电，同时这个过程又正好把初级线圈中存储的能量给释放了出来，能量放完后再等待下一次MOS管打开给它充电，这样就完成一个循环
>
> 简单来说就是：
>
> `MOS管打开：初级线圈储能`
>
> `MOS管关闭：初级线圈释放能量`
>
> 而输出的这个电压值可以通过计算：
>
> $Vin\text{(输入电压值)}=\frac{Vout\text{(输出电压值)}}{N\text{(变压器匝数比)}}\times\frac{D\text{(PWM占空比)}}{1-D}$
>
> <img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230926085906.webp" style="zoom:50%;" />
>
> <img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230926091239.webp" style="zoom:67%;" />
>
> 而为了保证反激电源的正常运行，一般还要加两部分电路：
>
> - RCD电路
>
> 因为各种原因这颗MOS管的PWM波这边其实存在一个非常大的尖峰，它的存在可能会导致MOS管烧毁，这个RCD电路就是用来吸收这个尖峰的，尖峰产生的时候会通过这个路径，迅速被这个电容给吸收掉
>
> ![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230926094133.webp)
>
> 然后在剩余的时间里，这颗电容的能量又会通过这个电阻给释放掉，经过这个循环，尖峰就会被消减很多确保MOS管安全
>
> ![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230926094309.webp)
>
> - 反馈电路
>
> 它是用来监测输出电压值的
>
> `输出电压<5V，就增加PWM占空比`
>
> `输出电压>5V，就减小PWM占空比`
>
> 那正常来说直接加电阻分压就可以了，但是因为这个左边是强电，为了安全考虑需要做隔离，所以就用一颗光耦来传递电压，上面部分电能传过去用的是磁能，下面的电压反馈回去是使用光，原边和副边是完全隔离的
>
> <img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230926094457.webp" style="zoom:67%;" />
>
> <img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230926095035.webp" style="zoom:50%;" />

> 所谓的ACDC其实就是两部分：
>
> - 220V交流电转变为310V的直流电这部分才是真正意义上的ACDC
>
> - 后面部分其实是DCDC，而反激拓扑其实仅仅指的是DCDC这部分电路
>
> <img src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230926095749.webp" style="zoom:50%;" />

> 电源纹波：我们把叠加在直流电压上的交流分量叫做电源纹波
>
> ![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230930215143.webp)
>
> 测量注意点：
>
> 1. 测试点尽量靠近芯片电源引脚
> 2. 接地线尽量短，不要使用那种长的有夹子那种，要使用接地弹簧那种
> 3. 电源纹波需要在空载和满载的条件下测试
> 4. 使用正确的耦合方式
>
> AC耦合：只保留交流信号，过滤DC部分，而且还会漏掉重负载下的电压跌落以及无法看到动态电压频率调整的过程
>
> DC耦合：直流和交流信号都保留，如果想看电源的原来样子可以使用这种

> `工作电压`：绝缘两端在正常工作的情况下所承受的最大的电压。工作电压有工作电压峰值和有效值，工作电压峰值用来确定绝缘隔离带的电气间隔，工作电压有效值用来确定绝缘隔离带的爬电距离
>
> `重复峰值`：由于操作或可调节器件而引起的超过静态输入电压值的重复性的过电压，这种重复性的过电压可能会因局部放电引起绝缘性能的降低，破坏
>
> `电气间隙`：在两个导电零部件之间或导电零部件与设备界面之间测得的最短距离
>
> `爬电距离`：沿绝缘表面测得的两个导电零部件之间或导电零部件与设备界面之间的最短距离，需要查表(GB 4943)
>
> `绝缘穿透距离`：在连个导电零部件或导电零部件与设备界面之间的绝缘材料的最小厚度

> `485芯片`引脚说明:
>
> | 引脚 | 名称 | 功能                              |
> | :--: | :--: | --------------------------------- |
> |  1   |  RO  | 接收器输出----接RX                |
> |  2   |  RE  | 接收器输出使能（低电平-接收使能） |
> |  3   |  DE  | 驱动器输出使能（高电平-发送使能） |
> |  4   |  DI  | 驱动器输入----接TX                |
> |  5   | GND  | 接地                              |
> |  6   |  A   | 驱动器输出/接收器输入（同相）     |
> |  7   |  B   | 驱动器输出/接收器输入（反相）     |
> |  8   | VCC  | 芯片供电+3.3V                     |