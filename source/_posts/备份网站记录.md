---
title: 备份网站记录
cover: /img/num83.webp
comments: false
categories:
  - 本站点滴
abbrlink: 8e0bee35
date: 2022-06-27 21:06:00
updated: 2022-10-03 16:32:43
---
##  服务器第一次被入侵
今天被入侵了服务器，还好及时备份站点和数据库然后重装系统，目前已经恢复了
![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20220627192233.jpg)
首先就是备份站点跟数据库，下载到本地，记得恢复时数据库名称和密码要和之前一样（最好截个图以防万一）
{% gallery %}
![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20220627201142.png)
![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20220627201130.jpg)
![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20220627201352%20.png)
![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20220627201405.png)
![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/dd75ab70997b4b1d8f400d531d32b658.png)
{% endgallery %}
然后选择重装

重装完后使用 shell 远程连接服务器，这里注意：
在服务器中输入`sudo nano /etc/ssh/sshd_config` ，按方向`↓`找到`PasswordAuthentication yes`，把前面的 # 删掉，在`PasswordAuthentication no`前加个 # 注释掉，`Ctrl + O`保存并`Enter`,接着 `Ctrl + X`退出

然后`sudo passwd`，然后输入用户密码，即可设置root固定密码了，接着执行`service sshd restart`后重新启动，输入自己设置的密码，重新用Xhell连接服务器即可
连接服务器后安装旧版本的宝塔（7.7版本），不要用最新的7.9，在 shell 里输入下面的命令安装即可：
```cpp
yum install -y wget && wget -O install.sh http://download.yu.al/ltd/install/install_6.0.sh && sh install.sh
```
安装完成后输入 `bt` 命令会出现菜单，输入菜单序号修改用户名和用户密码，然后清除面板缓存重启面板，再输入 `14` 显示宝塔面板的访问地址就可以登陆面板了，默认企业版pj版，参考博文：[捷径之地][7]
恢复数据的话上面简单说了没什么注意的主要还有是面板的软件得重新安装（php8.0，php7.3，MySQL8.0，OneNav等等），然后就是把服务器密码和面板密码改一下不要跟之前一样，面板的端口和ssh端口也改一下，在服务器上执行`netstat -tulnp`命令可以看当前端口，设置端口需要注意不要占用别的
注意面板的防火墙需要把 `POST过滤` 关闭了不然博客外观修改不了

##  服务器MYSQL内存占用大问题
打开 MYSQL 设置里面，把配置改成这样
![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20221003162925.jpg)
然后定期去日志那清空日志，二进制日志可以关了，那个唯一的用处是可以恢复数据库，关了就不会生成那么多文件了可以定期手动去备份数据库


  
  
  