## 2023-1-16

## 星空背景

参考文章：https://tzy1997.com/articles/hexo1606/#%E6%98%9F%E7%A9%BA%E8%83%8C%E6%99%AF%E5%92%8C%E6%B5%81%E6%98%9F%E7%89%B9%E6%95%88

## 添加复制弹窗

引进css,js，然后添加 `<script>...</script>` 内容【都在主题配置文件里操作】，随便把它的镜像源改成下面这样速度快点

## 替换js镜像源

在 `scripts` --> `cdn.js` 里把 cdn.jsdelivr.net 替换成 jsd.onmicrosoft.cn 
可用的镜像源有：
    
    npm.sourcegcdn.com

    npm.elemecdn.com

    npm.onmicrosoft.cn

    jsew.cky.codes

    jsd.onmicrosoft.cn

## gulp压缩

参考文章：https://blog.imzjw.cn/posts/b74f504f/#gulp-%E5%8E%8B%E7%BC%A9

需要注意完成文章操作后需要再执行 `npm install gulp` 命令才能使用 `gulp` 命令

使用格式：hexo cl && hexo g && gulp && hexo d

## 创建my.css【用于存放我的自定义css】

## 页脚

参考文章：https://blog.imzjw.cn/posts/b74f504f/#%E9%A1%B5%E8%84%9A%E5%BE%BD%E6%A0%87

添加一些图标，可在https://shields.io/category/issue-tracking 生成

## 修改了源码的all.min.css

把 all.min.css部署在腾讯云对象存储里，需要在主题文件 `plugins.yml` 里找到下面代码屏蔽：
```yml
# fontawesomeV6:
#   name: '@fortawesome/fontawesome-free'
#   file: css/all.min.css
#   other_name: font-awesome
#   version: 6.2.1
```
按F12把需要的 `.woff2` 后缀文件下载(.ttf不需要只需要woff2即可)上传到对象存储 `all.min.css` 同级目录下，然后把css里面 `.woff2` 的相对路径改成 `./xxx.woff2` 即可，然后把css链接复制在主题配置文件里引入，还需要注意跨域问题，添加规则，可参考：

https://cloud.tencent.com/document/product/436/11488

https://cloud.tencent.com/document/product/436/56652

## 页脚透明化

在 `my.css` 添加即可

## 2023-1-18

## 添加留言页面+留言板信封

1. 使用命令 `hexo new page comments` 创建一个留言页面

2. 输入安装插件命令 `npm install hexo-butterfly-envelope --save`

3. 在主题配置文件里添加 `envelope_comment` 配置

参考文章：

https://akilar.top/posts/e2d3c450/

https://blog.imzjw.cn/posts/b74f504f/#%E7%95%99%E8%A8%80%E6%9D%BF%E4%BF%A1%E5%B0%81

## 修改侧栏公告

在 `card_announcement.pug` 文件里第4行 `i.fas.fa-bullhorn.fa-shake` 替换成 `i.fas.fa-bullhorn`

## 修改了网站的图标颜色样式
具体在 `my.css`

## 全局字体引入外部

引入 `鸿蒙字体`，具体在主题配置那引入，字体名：`HarmonyOS_Regular`

## 添加双栏插件

输入插件安装命令 `npm i hexo-butterfly-article-double-row --save`，然后在根配置文件添加 `butterfly_article_double_row` 相关配置即可

## 添加评论

1. 首先 `建一个公开的仓库`

2. 在 `settings` --## `general` --## `Features` --## 勾选`Discussions `，按步骤写信息即可，创建完后分类默认是 `Announcements`(公告)

3. 前往 https://github.com/apps/giscus 安装giscus APP ，选择你那个评论的仓库即可

4. 前往 https://giscus.app/zh-CN 按步骤写仓库名啥的，然后它会生成配置直接按名字复制到主题配置文件下的 `giscus`配置项里配置即可，还要在 `comments`配置项选择 `giscus`

![](https://image-1309791158.cos.ap-guangzhou.myqcloud.com/butterfly/blog_other/QQ%E6%88%AA%E5%9B%BE20230119112814.jpg)

还需要在 `.md` 文件里加入关键字来关闭一些页面的评论 `comments: false` 这样显得好看点

## 修改文章目录样式

1. 在 `my.css` 添加样式即可(蒙版效果)

## 修改侧栏小卡片

1. 在 `my.css` 添加样式即可

## JS和CSS加载问题

参考文章：https://akilar.top/posts/615d5ede/

JS加载会阻塞HTML页面的加载，所以有必要进行异步加载，减少阻塞，JS的引入有两个属性值 `defer` 和 `async` ：

`defer` 是除了告诉浏览器不要阻塞页面之外，还可以确保脚本执行的相对顺序(加在那些确保页面完整性的必要js上)

`async` 是其他脚本不会等待async脚本加载完成，同样,async脚本也不会等待其他脚本(一般加在那些非必要的，起装饰或者优化效果的js上)

CND配置项的引入先于 `inject`，故也需要加属性值，在主题文件夹下---`layout` --- `includes` --- `additional-js.pug` 中修改，添加了属性值(具体可去查看)

- 页面载入并渲染的流程可以简单理解为以下情况：

`加载HTML资源->解析HTML->加载CSS资源，同时构建DOM树->解析CSS，同时渲染DOM树`



css的异步加载有两种方式，其中一种是加这句 `media="defer" onload="this.media='all'"`，【这里通过定义一个无效media，使得该CSS引入优先级最低，再用onload="this.media='all'"在页面加载完成后纠正media，并加载CSS】<span style="color:red;">目前在用第一种方法</span>

事实上，相比于给CSS添加异步加载，不如将我们的魔改样式整合到index.css文件内，减少对服务器的请求次数。这样更能节省加载时间【下面操作仅针对于Butterfly主题】  步骤如下【做完图标没了...故没搞】：

主题下的 `source\css\` 路径下新建 `_custom` 文件夹，然后把魔改样式的CSS文件拖动进去，然后在 `index.styl` 引入

## Mathjs

1. 首先禁用MathJax（如果你配置过 MathJax 的话），然后开启 `katex` 配置项

2. 如果想要支持数学公式，需要 `卸载你之前的 hexo 的 markdown 渲染器`，安装下面这个：
```bash
npm un hexo-renderer-marked --save # 如果有安装这个的话，卸载
npm un hexo-renderer-kramed --save # 如果有安装这个的话，卸载

npm i hexo-renderer-markdown-it --save # 需要安装这个渲染插件
npm install katex @renbaoshuo/markdown-it-katex # 需要安装这个katex插件
```
3. 在根目录配置文件加入：
```yml
markdown:
    plugins:
      - '@renbaoshuo/markdown-it-katex'
```
4. 使用时只需在需要数学公式的文章开头处加入 `katex: true` 即可

## 文章加密插件
<span style="color:red;">开启文章加密会有bug目录蒙版显示有问题！</span>
1. 安装 `npm install --save hexo-blog-encrypt`
2. 语法：
```bash
password: mikemessi
abstract: 有东西被加密了, 请输入密码查看.
message: 您好, 这里需要密码.
theme: xray
wrong_pass_message: 抱歉, 这个密码看着不太对, 请再试试.
wrong_hash_message: 抱歉, 这个文章不能被校验, 不过您还是能看看解密后的内容.
```
主题有多种：  `default、blink、shrink、flip、up、surge、wave、xray`

## 自定义右键
参考文章：https://yisous.xyz/posts/11eb4aac/

1. 在主题文件下新建 `\themes\butterfly\layout\includes\rightmenu.pug`
2. 然后在 `/themes/butterfly/layout/includes/layout.pug` 中引入(注意缩进要跟上面一行一样)：
```pug
!=partial('includes/rightmenu',{}, {cache:true})
```
3. 主题文件下新建 `/themes/butterfly/source/css/rightmenu.css` ，然后在主题配置文件里引入 `<link rel="stylesheet" href="/css/rightmenu.css">`
4. 在主题文件下新建 `/themes/butterfly/source/js/rightmenu.js` ，然后需要在主题配置文件引入：
```yml
  - <script type="text/javascript" src="https://cdn1.tianli0.top/npm/jquery@latest/dist/jquery.min.js"></script>
  - <script type="text/javascript" src="/js/rightmenu.js"></script>
```

<span style="color:red;">备注</span>：

- 上面的镜像 `cdn1.tianli0.top` 需要换成 `jsd.onmicrosoft.cn` 或者其他可以用的镜像源

- 去除一些不常用的选项，通过修改 `includes\rightmenu.pug` 文件即可，把不需要的直接删，然后改一下背景颜色在css那

## 侧栏IP信息显示

参考文章：https://ichika.cc/Article/beautiful_IPLocation/

1. 主题文件下创建了 `/themes/butterfly/source/js/IPdw.js`，把需要的js代码丢进去即可，然后改一下key，调用是 `#welcome-info`
2. 打开腾讯定位服务网站 https://lbs.qq.com/service/webService/webServiceGuide/webServiceIp  申请应用【产品选择WebServiceAPI，域名白名单填自己的域名或不填，如果到时候不能正常获取则原因可能是白名单设置有问题】 
可以访问下面链接看看能不能正常返回数据(key=你自己的key)：
https://apis.map.qq.com/ws/location/v1/ip?ip=111.206.145.41&key=7L3BZ-SDZLV-RZ3PR-UQMW2-EBJN7-45FBA
3. 在主题文件 `/theme/butterfly/latout/includes/widget/card_announcement.pug` 下修改成这样(添加一行注释下面几行)：
```pug
if theme.aside.card_announcement.enable
  .card-widget.card-announcement
    #welcome-info
    .item-headline
    //-   i.fas.fa-bullhorn
    //-   span= _p('aside.card_announcement')
    //- .announcement_content!= theme.aside.card_announcement.content
```







